{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Inscription Confirmée" %} - A²ELBM2{% endblock %}

{% block content %}
<br> <br> <br> <br>

<!-- Success Section -->
<section class="success-section py-6">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-6">
                <div class="success-card bg-white rounded-4 shadow-lg p-5 text-center" data-aos="zoom-in">
                    <!-- Success Animation -->
                    <div class="success-animation mb-4">
                        <div class="success-checkmark">
                            <div class="check-icon">
                                <span class="icon-line line-tip"></span>
                                <span class="icon-line line-long"></span>
                                <div class="icon-circle"></div>
                                <div class="icon-fix"></div>
                            </div>
                        </div>
                    </div>
                    
                    <h1 class="display-6 fw-bold text-success mb-4">
                        {% trans "Inscription Confirmée !" %}
                    </h1>
                    
                    <p class="lead text-muted mb-5">
                        {% trans "Félicitations ! Votre inscription à l'événement" %} 
                        <strong class="text-primary">
                            {% if LANGUAGE_CODE == 'fr' %}
                                "{{ event.title_fr }}"
                            {% else %}
                                "{{ event.title_en|default:event.title_fr }}"
                            {% endif %}
                        </strong> 
                        {% trans "a été enregistrée avec succès." %}
                    </p>
                    
                    <!-- Event Reminder Card -->
                    <div class="event-reminder bg-light rounded-3 p-4 mb-5">
                        <h3 class="h5 fw-bold mb-3 text-primary">
                            <i class="fas fa-calendar-check me-2"></i>
                            {% trans "Rappel de l'Événement" %}
                        </h3>
                        
                        <div class="row g-3 text-start">
                            <div class="col-md-6">
                                <div class="reminder-item">
                                    <i class="fas fa-clock text-warning me-2"></i>
                                    <strong>{% trans "Date & Heure" %}</strong><br>
                                    <span class="text-muted">{{ event.date_event|date:"l d F Y à H:i" }}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="reminder-item">
                                    <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                    <strong>{% trans "Lieu" %}</strong><br>
                                    <span class="text-muted">{{ event.location }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Next Steps -->
                    <div class="next-steps mb-5">
                        <h3 class="h5 fw-bold mb-4">{% trans "Prochaines Étapes" %}</h3>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="step-item">
                                    <div class="step-icon bg-primary text-white rounded-circle mb-2 mx-auto" style="width: 50px; height: 50px;">
                                        <i class="fas fa-envelope d-flex align-items-center justify-content-center h-100"></i>
                                    </div>
                                    <h6 class="fw-semibold">{% trans "Confirmation" %}</h6>
                                    <small class="text-muted">{% trans "Un email de confirmation vous sera envoyé" %}</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="step-item">
                                    <div class="step-icon bg-warning text-dark rounded-circle mb-2 mx-auto" style="width: 50px; height: 50px;">
                                        <i class="fas fa-bell d-flex align-items-center justify-content-center h-100"></i>
                                    </div>
                                    <h6 class="fw-semibold">{% trans "Rappel" %}</h6>
                                    <small class="text-muted">{% trans "Nous vous rappellerons avant l'événement" %}</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="step-item">
                                    <div class="step-icon bg-success text-white rounded-circle mb-2 mx-auto" style="width: 50px; height: 50px;">
                                        <i class="fas fa-calendar-check d-flex align-items-center justify-content-center h-100"></i>
                                    </div>
                                    <h6 class="fw-semibold">{% trans "Participation" %}</h6>
                                    <small class="text-muted">{% trans "Présentez-vous le jour J" %}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Info -->
                    <div class="contact-info bg-primary bg-opacity-10 rounded-3 p-4 mb-5">
                        <h3 class="h6 fw-bold mb-3">
                            <i class="fas fa-phone text-primary me-2"></i>
                            {% trans "Besoin d'Aide ?" %}
                        </h3>
                        <p class="mb-3">{% trans "Pour toute question concernant votre inscription ou l'événement, n'hésitez pas à nous contacter." %}</p>
                        
                        <div class="contact-buttons d-flex flex-wrap gap-2 justify-content-center">
                            <a href="{% url 'contact' %}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-envelope me-1"></i>
                                {% trans "Nous Écrire" %}
                            </a>
                            <a href="{% url 'whatsapp_redirect' %}?type=president&message=Bonjour, j'ai une question concernant mon inscription à l'événement {{ event.title_fr }}" class="btn btn-outline-success btn-sm">
                                <i class="fab fa-whatsapp me-1"></i>
                                {% trans "WhatsApp" %}
                            </a>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <a href="{% url 'event_detail' event.pk %}" class="btn btn-outline-primary me-3">
                            <i class="fas fa-arrow-left me-2"></i>
                            {% trans "Retour à l'Événement" %}
                        </a>
                        <a href="{% url 'events' %}" class="btn btn-primary">
                            <i class="fas fa-calendar me-2"></i>
                            {% trans "Autres Événements" %}
                        </a>
                    </div>
                    
                    <!-- Share Section -->
                    <div class="share-section mt-5 pt-4 border-top">
                        <h3 class="h6 fw-bold mb-3">{% trans "Partagez avec vos Amis" %}</h3>
                        <div class="share-buttons d-flex gap-2 justify-content-center">
                            <button class="btn btn-outline-success btn-sm" onclick="shareEventOnWhatsApp()">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="shareEventOnFacebook()">
                                <i class="fab fa-facebook"></i>
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="copyEventLink()">
                                <i class="fas fa-link"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Events Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5" data-aos="fade-up">
            <h2 class="h4 fw-bold mb-3">{% trans "Découvrez Nos Autres Événements" %}</h2>
            <p class="text-muted">{% trans "Ne manquez aucun de nos événements à venir" %}</p>
        </div>
        
        <div class="text-center">
            <a href="{% url 'events' %}" class="btn btn-outline-primary btn-lg">
                <i class="fas fa-calendar-alt me-2"></i>
                {% trans "Voir Tous les Événements" %}
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
    .py-6 {
        padding: 6rem 0;
    }
    
    .success-card {
        position: relative;
        overflow: hidden;
    }
    
    .success-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #28a745, #20c997);
    }
    
    /* Success Animation Styles */
    .success-animation {
        width: 100px;
        height: 100px;
        margin: 0 auto;
    }
    
    .success-checkmark {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        display: block;
        stroke-width: 3;
        stroke: #28a745;
        stroke-miterlimit: 10;
        box-shadow: inset 0px 0px 0px #28a745;
        animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        position: relative;
    }
    
    .success-checkmark .icon-circle {
        stroke-dasharray: 166;
        stroke-dashoffset: 166;
        stroke-width: 3;
        stroke-miterlimit: 10;
        stroke: #28a745;
        fill: none;
        animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        
        width: 100px;
        height: 100px;
        border-radius: 50%;
        left: 0;
        top: 0;
        position: absolute;
        border: 3px solid #28a745;
    }
    
    .success-checkmark .check-icon {
        transform-origin: 50% 50%;
        stroke-dasharray: 48;
        stroke-dashoffset: 48;
        animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 30px;
        height: 30px;
    }
    
    .success-checkmark .check-icon .icon-line {
        display: block;
        stroke-width: 3;
        stroke: #28a745;
        stroke-linecap: round;
        position: absolute;
    }
    
    .success-checkmark .check-icon .line-tip {
        top: 17px;
        left: 7px;
        width: 7px;
        transform: rotate(45deg);
        height: 3px;
    }
    
    .success-checkmark .check-icon .line-long {
        top: 14px;
        right: 5px;
        width: 16px;
        transform: rotate(-45deg);
        height: 3px;
    }
    
    @keyframes stroke {
        100% {
            stroke-dashoffset: 0;
        }
    }
    
    @keyframes scale {
        0%, 100% {
            transform: none;
        }
        50% {
            transform: scale3d(1.1, 1.1, 1);
        }
    }
    
    @keyframes fill {
        100% {
            box-shadow: inset 0px 0px 0px 100px #28a745;
        }
    }
    
    /* Step Items */
    .step-item {
        text-align: center;
        padding: 1rem;
    }
    
    .step-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .step-item:hover .step-icon {
        transform: scale(1.1);
    }
    
    /* Reminder Item */
    .reminder-item {
        margin-bottom: 1rem;
    }
    
    .reminder-item:last-child {
        margin-bottom: 0;
    }
    
    /* Contact Buttons */
    .contact-buttons .btn {
        transition: all 0.3s ease;
    }
    
    .contact-buttons .btn:hover {
        transform: translateY(-2px);
    }
    
    /* Share Buttons */
    .share-buttons .btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .share-buttons .btn:hover {
        transform: scale(1.1);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .py-6 {
            padding: 4rem 0;
        }
        
        .success-card {
            padding: 2rem !important;
        }
        
        .action-buttons .btn {
            display: block;
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .action-buttons .me-3 {
            margin-right: 0 !important;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
function shareEventOnFacebook() {
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(eventUrl)}`, '_blank');
}

function copyEventLink() {
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    navigator.clipboard.writeText(eventUrl).then(function() {
        // Créer une notification temporaire
        const notification = document.createElement('div');
        notification.className = 'alert alert-success position-fixed';
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = '<i class="fas fa-check me-2"></i>{% trans "Lien copié dans le presse-papier!" %}';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }).catch(function() {
        alert('{% trans "Impossible de copier le lien. Veuillez le copier manuellement." %}');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    // Animation de décompte jusqu'à l'événement
    const eventDate = new Date("{{ event.date_event|date:'Y-m-d H:i:s' }}");
    const now = new Date();
    
    if (eventDate > now) {
        const diffTime = Math.abs(eventDate - now);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays <= 30) {
            const countdownElement = document.createElement('div');
            countdownElement.className = 'alert alert-info mt-3';
            countdownElement.innerHTML = `
                <i class="fas fa-hourglass-half me-2"></i>
                <strong>{% trans "Plus que" %} ${diffDays} {% trans "jour(s) avant l'événement !" %}</strong>
            `;
            
            const reminderCard = document.querySelector('.event-reminder');
            if (reminderCard) {
                reminderCard.appendChild(countdownElement);
            }
        }
    }
    
    // Animation d'entrée pour les éléments
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });
    
    // Observer les éléments step
    document.querySelectorAll('.step-item').forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        item.style.transition = `opacity 0.6s ease ${index * 0.2}s, transform 0.6s ease ${index * 0.2}s`;
        observer.observe(item);
    });
});
OnWhatsApp() {
    const title = "{{ event.title_fr|escapejs }}";
    const date = "{{ event.date_event|date:'d M Y à H:i' }}";
    const location = "{{ event.location|escapejs }}";
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    const text = `🎉 Je viens de m'inscrire à l'événement : ${title}\n\n📅 Date : ${date}\n📍 Lieu : ${location}\n\nRejoignez-nous ! Plus d'infos : ${eventUrl}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
}


function shareEventOnFacebook() {
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(eventUrl)}`, '_blank');
}

function shareEventOnWhatsApp() {
    const title = "{{ event.title_fr|escapejs }}";
    const date = "{{ event.date_event|date:'d M Y à H:i' }}";
    const location = "{{ event.location|escapejs }}";
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    const text = `🎉 Je viens de m'inscrire à l'événement : ${title}\n\n📅 Date : ${date}\n📍 Lieu : ${location}\n\nRejoignez-nous ! Plus d'infos : ${eventUrl}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
}

function copyEventLink() {
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    navigator.clipboard.writeText(eventUrl).then(function() {
        // Créer une notification temporaire
        const notification = document.createElement('div');
        notification.className = 'alert alert-success position-fixed';
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; animation: slideInRight 0.5s ease, slideOutRight 0.5s ease 2.5s forwards;';
        notification.innerHTML = '<i class="fas fa-check me-2"></i>{% trans "Lien copié dans le presse-papier!" %}';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification && notification.parentNode) {
                notification.remove();
            }
        }, 3000);
    }).catch(function() {
        // Fallback pour les navigateurs qui ne supportent pas clipboard API
        const textArea = document.createElement('textarea');
        textArea.value = eventUrl;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            const notification = document.createElement('div');
            notification.className = 'alert alert-success position-fixed';
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = '<i class="fas fa-check me-2"></i>{% trans "Lien copié dans le presse-papier!" %}';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification && notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        } catch (err) {
            alert('{% trans "Impossible de copier le lien. Veuillez le copier manuellement." %}');
        }
        document.body.removeChild(textArea);
    });
}

function shareEventOnTwitter() {
    const title = "{{ event.title_fr|escapejs }}";
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    const text = `🎉 Je participe à l'événement : ${title}`;
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(eventUrl)}`, '_blank');
}

function shareEventOnLinkedIn() {
    const eventUrl = "{{ request.build_absolute_uri }}".replace('/register/success/', '/');
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(eventUrl)}`, '_blank');
}

function addToCalendar() {
    const title = "{{ event.title_fr|escapejs }}";
    const location = "{{ event.location|escapejs }}";
    const startDate = new Date("{{ event.date_event|date:'Y-m-d H:i:s' }}");
    const endDate = new Date(startDate.getTime() + (2 * 60 * 60 * 1000)); // 2h par défaut
    
    const formatDate = (date) => {
        return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    };
    
    const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${formatDate(startDate)}/${formatDate(endDate)}&location=${encodeURIComponent(location)}&details=${encodeURIComponent('Événement organisé par A²ELBM2')}`;
    
    window.open(calendarUrl, '_blank');
}

function downloadConfirmation() {
    const content = `
        CONFIRMATION D'INSCRIPTION
        ==========================
        
        Événement: {{ event.title_fr|escapejs }}
        Date: {{ event.date_event|date:'d M Y à H:i' }}
        Lieu: {{ event.location|escapejs }}
        
        Statut: Inscription confirmée ✓
        
        ---
        A²ELBM2 - Association des Anciens Élèves
        Date de confirmation: ${new Date().toLocaleDateString('fr-FR')}
    `;
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'confirmation_inscription.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Animation du compteur de jours
function animateCounter(element, target, duration = 1000) {
    const start = 0;
    const increment = target / (duration / 16);
    let current = start;
    
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            current = target;
            clearInterval(timer);
        }
        element.textContent = Math.floor(current);
    }, 16);
}

// Fonction pour créer des confettis
function createConfetti() {
    const colors = ['#28a745', '#0d6efd', '#ffc107', '#dc3545', '#6c757d'];
    const confettiCount = 50;
    
    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.style.cssText = `
            position: fixed;
            width: 10px;
            height: 10px;
            background: ${colors[Math.floor(Math.random() * colors.length)]};
            top: -10px;
            left: ${Math.random() * 100}vw;
            z-index: 10000;
            pointer-events: none;
            animation: confettiFall ${2 + Math.random() * 3}s linear forwards;
            transform: rotate(${Math.random() * 360}deg);
        `;
        
        document.body.appendChild(confetti);
        
        setTimeout(() => {
            if (confetti && confetti.parentNode) {
                confetti.remove();
            }
        }, 5000);
    }
}

// Fonction pour valider l'email (si nécessaire)
function validateEmail(email) {
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
}

// Fonction pour afficher des notifications toast
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-info';
    
    toast.className = `toast align-items-center text-white ${bgClass} border-0 position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} me-2"></i>
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Auto-remove après 4 secondes
    setTimeout(() => {
        if (toast && toast.parentNode) {
            toast.remove();
        }
    }, 4000);
}

// Event listener principal
document.addEventListener('DOMContentLoaded', function() {
    // Animation de décompte jusqu'à l'événement
    const eventDate = new Date("{{ event.date_event|date:'Y-m-d H:i:s' }}");
    const now = new Date();
    
    if (eventDate > now) {
        const diffTime = Math.abs(eventDate - now);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const diffHours = Math.ceil(diffTime / (1000 * 60 * 60));
        
        if (diffDays <= 30) {
            const countdownElement = document.createElement('div');
            countdownElement.className = 'alert alert-info mt-3 text-center';
            
            if (diffDays > 1) {
                countdownElement.innerHTML = `
                    <i class="fas fa-hourglass-half me-2"></i>
                    <strong>Plus que <span class="text-primary fs-5" id="dayCounter">${diffDays}</span> jour(s) avant l'événement !</strong>
                `;
            } else if (diffHours > 1) {
                countdownElement.innerHTML = `
                    <i class="fas fa-clock me-2"></i>
                    <strong>Plus que <span class="text-warning fs-5">${diffHours}</span> heure(s) avant l'événement !</strong>
                `;
            } else {
                countdownElement.innerHTML = `
                    <i class="fas fa-fire me-2"></i>
                    <strong class="text-danger">L'événement commence bientôt !</strong>
                `;
            }
            
            const reminderCard = document.querySelector('.event-reminder');
            if (reminderCard) {
                reminderCard.appendChild(countdownElement);
                
                // Animation du compteur
                const dayCounter = document.getElementById('dayCounter');
                if (dayCounter) {
                    dayCounter.textContent = '0';
                    setTimeout(() => animateCounter(dayCounter, diffDays), 500);
                }
            }
        }
    }
    
    // Animation d'entrée pour les éléments
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });
    
    // Observer les éléments step avec délai
    document.querySelectorAll('.step-item').forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        item.style.transition = `opacity 0.6s ease ${index * 0.2}s, transform 0.6s ease ${index * 0.2}s`;
        observer.observe(item);
    });
    
    // Animation des boutons de partage
    document.querySelectorAll('.share-buttons .btn').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1) rotate(5deg)';
        });
        
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) rotate(0deg)';
        });
    });
    
    // Animation des boutons d'action
    document.querySelectorAll('.action-buttons .btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255,255,255,0.6);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s linear;
                pointer-events: none;
            `;
            
            this.style.position = 'relative';
            this.style.overflow = 'hidden';
            this.appendChild(ripple);
            
            setTimeout(() => {
                if (ripple && ripple.parentNode) {
                    ripple.remove();
                }
            }, 600);
        });
    });
    
    // Confettis après un délai
    setTimeout(() => {
        createConfetti();
    }, 1000);
    
    // Sauvegarde locale de l'inscription (pour le cache)
    const registrationData = {
        eventId: "{{ event.pk }}",
        eventTitle: "{{ event.title_fr|escapejs }}",
        registrationDate: new Date().toISOString(),
        eventDate: "{{ event.date_event|date:'Y-m-d H:i:s' }}"
    };
    
    try {
        const existingRegistrations = JSON.parse(localStorage.getItem('userRegistrations') || '[]');
        existingRegistrations.push(registrationData);
        localStorage.setItem('userRegistrations', JSON.stringify(existingRegistrations));
    } catch (e) {
        // Si localStorage n'est pas disponible, on ignore silencieusement
        console.log('LocalStorage non disponible');
    }
});

{% endblock %}
