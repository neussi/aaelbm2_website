{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load custom_filters %}

{% block title %}
    {% if LANGUAGE_CODE == 'fr' %}
        {{ article.title_fr }}
    {% else %}
        {{ article.title_en|default:article.title_fr }}
    {% endif %} - A²ELBM2
{% endblock %}

{% block content %}
<!-- Hero Section -->
<br> <br> <br>
<section class="news-hero position-relative overflow-hidden" style="min-height: 60vh; background: linear-gradient(135deg, rgba(44,85,48,0.95) 0%, rgba(74,124,89,0.9) 100%);">
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: url('{% static 'images/news-pattern.svg' %}') repeat; opacity: 0.1;"></div>
    <br> <br> <br>
    
    <div class="container h-100 d-flex align-items-center position-relative">
        <div class="row w-100 align-items-center">
            <div class="col-lg-8" data-aos="fade-right">
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-white-50">{% trans "Accueil" %}</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'news' %}" class="text-white-50">{% trans "Actualités" %}</a></li>
                        <li class="breadcrumb-item active text-white">
                            {% if LANGUAGE_CODE == 'fr' %}
                                {{ article.title_fr|truncatechars:30 }}
                            {% else %}
                                {{ article.title_en|default:article.title_fr|truncatechars:30 }}
                            {% endif %}
                        </li>
                    </ol>
                </nav>
                
                <!-- Article Status Badges -->
                <div class="mb-4">
                    <span class="badge bg-warning text-dark rounded-pill px-4 py-2" style="font-size: 1.1rem;">
                        <i class="fas fa-newspaper me-2"></i>
                        {% trans "Actualité" %}
                    </span>
                    
                    {% if article.is_featured %}
                        <span class="badge bg-danger rounded-pill px-3 py-2 ms-2">
                            <i class="fas fa-star me-1"></i>
                            {% trans "À la Une" %}
                        </span>
                    {% endif %}
                </div>
                
                <h1 class="display-4 fw-bold text-white mb-4" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.5);">
                    {% if LANGUAGE_CODE == 'fr' %}
                        {{ article.title_fr }}
                    {% else %}
                        {{ article.title_en|default:article.title_fr }}
                    {% endif %}
                </h1>
                
                <!-- Article Meta -->
                <div class="article-meta mb-5">
                    <div class="d-flex flex-wrap gap-4 text-white-50">
                        <div class="meta-item">
                            <i class="fas fa-calendar me-2"></i>
                            <span>{{ article.publication_date|date:"l d F Y" }}</span>
                        </div>
                        {% if article.author %}
                        <div class="meta-item">
                            <i class="fas fa-user me-2"></i>
                            <span>{% trans "Par" %} {{ article.author.nom_prenom }}</span>
                        </div>
                        {% endif %}
                        <div class="meta-item">
                            <i class="fas fa-clock me-2"></i>
                            <span>{{ article.publication_date|timesince }} {% trans "ago" %}</span>
                        </div>
                    </div>
                </div>
                
                <div class="article-actions d-flex flex-wrap gap-3">
                    <a href="{% url 'contact' %}" class="btn btn-outline-light btn-lg px-5 py-3 rounded-pill">
                        <i class="fas fa-comment me-2"></i>
                        {% trans "Commentaire" %}
                    </a>
                    <button class="btn btn-warning btn-lg px-5 py-3 rounded-pill" onclick="shareArticle()">
                        <i class="fas fa-share-alt me-2"></i>
                        {% trans "Partager" %}
                    </button>
                </div>
            </div>
            
            <div class="col-lg-4 text-center" data-aos="fade-left" data-aos-delay="300">
                <div class="hero-visual position-relative">
                    {% if article.image %}
                        <img src="{{ article.image.url }}" alt="{{ article.title_fr }}" class="img-fluid rounded-4 shadow-lg" style="max-height: 350px; object-fit: cover;">
                    {% else %}
                        <div class="bg-white rounded-4 shadow-lg d-inline-flex align-items-center justify-content-center text-primary" style="width: 300px; height: 300px;">
                            <i class="fas fa-newspaper fa-5x"></i>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Article Content Section -->
<section class="py-6">
    <div class="container">
        <div class="row">
            <div class="col-lg-8" data-aos="fade-right">
                <!-- Main Article Content -->
                <div class="article-content bg-white rounded-4 p-5 shadow-sm mb-5">
                    <!-- Article Image (if not shown in hero) -->
                    {% if article.image and not article.is_featured %}
                    <div class="article-image mb-4">
                        <img src="{{ article.image.url }}" alt="{{ article.title_fr }}" class="img-fluid rounded-3 w-100" style="max-height: 400px; object-fit: cover;">
                    </div>
                    {% endif %}
                    
                    <!-- Article Content -->
                    <div class="content-rich">
                        {% if LANGUAGE_CODE == 'fr' %}
                            {{ article.content_fr|safe }}
                        {% else %}
                            {{ article.content_en|default:article.content_fr|safe }}
                        {% endif %}
                    </div>
                    
                    <!-- Article Tags/Categories (if needed) -->
                    <div class="article-tags mt-4 pt-4 border-top">
                        <h6 class="fw-bold mb-3">{% trans "Catégories" %}</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge bg-primary rounded-pill px-3 py-2">{% trans "Actualités" %}</span>
                            <span class="badge bg-secondary rounded-pill px-3 py-2">{% trans "Association" %}</span>
                            {% if article.is_featured %}
                                <span class="badge bg-warning text-dark rounded-pill px-3 py-2">{% trans "À la Une" %}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Share Section -->
                <div class="share-section bg-light rounded-4 p-4 mb-5" data-aos="fade-up">
                    <h5 class="fw-bold mb-3">
                        <i class="fas fa-share-alt text-primary me-2"></i>
                        {% trans "Partager cet Article" %}
                    </h5>
                    <div class="share-buttons d-flex flex-wrap gap-3">
                        <button class="btn btn-success" onclick="shareOnWhatsApp()">
                            <i class="fab fa-whatsapp me-2"></i>
                            WhatsApp
                        </button>
                        <button class="btn btn-primary" onclick="shareOnFacebook()">
                            <i class="fab fa-facebook me-2"></i>
                            Facebook
                        </button>
                        <button class="btn btn-info" onclick="shareOnTwitter()">
                            <i class="fab fa-twitter me-2"></i>
                            Twitter
                        </button>
                        <button class="btn btn-secondary" onclick="copyLink()">
                            <i class="fas fa-link me-2"></i>
                            {% trans "Copier le lien" %}
                        </button>
                    </div>
                </div>
                
                <!-- Author Info (if available) -->
                {% if article.author %}
                <div class="author-info bg-white rounded-4 p-4 shadow-sm mb-5" data-aos="fade-up">
                    <h5 class="fw-bold mb-3">
                        <i class="fas fa-user-edit text-primary me-2"></i>
                        {% trans "À propos de l'auteur" %}
                    </h5>
                    <div class="d-flex align-items-start">
                        <div class="author-avatar me-3">
                            {% if article.author.photo %}
                                <img src="{{ article.author.photo.url }}" alt="{{ article.author.nom_prenom }}" class="rounded-circle" style="width: 80px; height: 80px; object-fit: cover;">
                            {% else %}
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white" style="width: 80px; height: 80px;">
                                    <i class="fas fa-user fa-2x"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="author-details">
                            <h6 class="fw-bold mb-1">{{ article.author.nom_prenom }}</h6>
                            {% if article.author.poste_bureau %}
                                <div class="text-primary fw-semibold mb-2">{{ article.author.poste_bureau }}</div>
                            {% endif %}
                            {% if article.author.bio %}
                                <p class="text-muted mb-0">{{ article.author.bio|striptags|truncatewords:30 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="col-lg-4" data-aos="fade-left" data-aos-delay="300">
                <!-- Article Info Card -->
                <div class="article-info-card bg-white rounded-4 p-4 shadow-sm mb-4">
                    <h5 class="fw-bold mb-4">{% trans "Informations de l'Article" %}</h5>
                    
                    <div class="info-item mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-calendar text-primary me-3"></i>
                            <div>
                                <strong>{% trans "Date de publication" %}</strong><br>
                                <span class="text-muted">{{ article.publication_date|date:"d F Y" }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-item mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-clock text-warning me-3"></i>
                            <div>
                                <strong>{% trans "Heure de publication" %}</strong><br>
                                <span class="text-muted">{{ article.publication_date|time:"H:i" }}</span>
                            </div>
                        </div>
                    </div>
                    
                    {% if article.author %}
                    <div class="info-item mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user text-success me-3"></i>
                            <div>
                                <strong>{% trans "Auteur" %}</strong><br>
                                <span class="text-muted">{{ article.author.nom_prenom }}</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="info-item mb-4">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-eye text-info me-3"></i>
                            <div>
                                <strong>{% trans "Statut" %}</strong><br>
                                <span class="text-muted">
                                    {% if article.is_published %}
                                        {% trans "Publié" %}
                                    {% else %}
                                        {% trans "Brouillon" %}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <a href="{% url 'contact' %}" class="btn btn-primary w-100 rounded-pill">
                        <i class="fas fa-comment me-2"></i>
                        {% trans "Réagir à l'Article" %}
                    </a>
                </div>
                
                <!-- Related Articles -->
                {% if related_news %}
                <div class="related-articles-card bg-light rounded-4 p-4 mb-4">
                    <h5 class="fw-bold mb-4">{% trans "Articles Connexes" %}</h5>
                    
                    {% for related in related_news %}
                    <div class="related-article mb-3 pb-3 {% if not forloop.last %}border-bottom{% endif %}">
                        <div class="d-flex">
                            {% if related.image %}
                                <img src="{{ related.image.url }}" alt="{{ related.title_fr }}" class="rounded me-3" style="width: 60px; height: 60px; object-fit: cover;">
                            {% else %}
                                <div class="bg-secondary rounded me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                    <i class="fas fa-newspaper text-white"></i>
                                </div>
                            {% endif %}
                            <div class="flex-grow-1">
                                <h6 class="mb-1">
                                    <a href="{% url 'news_detail' related.pk %}" class="text-decoration-none">
                                        {% if LANGUAGE_CODE == 'fr' %}
                                            {{ related.title_fr|truncatechars:40 }}
                                        {% else %}
                                            {{ related.title_en|default:related.title_fr|truncatechars:40 }}
                                        {% endif %}
                                    </a>
                                </h6>
                                <small class="text-muted">{{ related.publication_date|date:"d M Y" }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <div class="text-center mt-3">
                        <a href="{% url 'news' %}" class="btn btn-outline-primary btn-sm">
                            {% trans "Voir toutes les actualités" %}
                        </a>
                    </div>
                </div>
                {% endif %}
                
                <!-- Newsletter Subscription -->
                <div class="newsletter-card bg-light text-white rounded-4 p-4">
                    <div class="text-center">
                        <i class="fas fa-envelope fa-2x mb-3"></i>
                        <h5 class="fw-bold mb-3">{% trans "Restez Informé" %}</h5>
                        <p class="mb-4">{% trans "Recevez nos dernières actualités directement dans votre boîte mail" %}</p>
                        <a href="{% url 'member_registration' %}" class="btn btn-warning btn-lg rounded-pill">
                            <i class="fas fa-bell me-2"></i>
                            {% trans "S'abonner" %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related News Section -->
{% if related_news %}
<section class="py-6 bg-light">
    <div class="container">
        <div class="text-center mb-5" data-aos="fade-up">
            <h2 class="h3 fw-bold mb-4">{% trans "Autres Actualités" %}</h2>
            <p class="text-muted">{% trans "Découvrez nos autres articles récents" %}</p>
        </div>
        
        <div class="row g-4">
            {% for related in related_news %}
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|mul:100 }}">
                <div class="card h-100 news-card-small">
                    {% if related.image %}
                        <img src="{{ related.image.url }}" class="card-img-top" alt="{{ related.title_fr }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                        <div class="card-img-top bg-gradient-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fas fa-newspaper text-white fa-2x"></i>
                        </div>
                    {% endif %}
                    
                    <div class="card-body d-flex flex-column">
                        <div class="mb-2">
                            <small class="text-muted">
                                <i class="fas fa-calendar me-1"></i>
                                {{ related.publication_date|date:"d M Y" }}
                            </small>
                            {% if related.is_featured %}
                                <span class="badge bg-warning ms-2">{% trans "À la une" %}</span>
                            {% endif %}
                        </div>
                        
                        <h6 class="card-title">
                            {% if LANGUAGE_CODE == 'fr' %}
                                {{ related.title_fr|truncatechars:60 }}
                            {% else %}
                                {{ related.title_en|default:related.title_fr|truncatechars:60 }}
                            {% endif %}
                        </h6>
                        
                        <p class="card-text flex-grow-1">
                            {% if LANGUAGE_CODE == 'fr' %}
                                {{ related.content_fr|striptags|truncatewords:15 }}
                            {% else %}
                                {{ related.content_en|default:related.content_fr|striptags|truncatewords:15 }}
                            {% endif %}
                        </p>
                        
                        <div class="mt-auto">
                            <a href="{% url 'news_detail' related.pk %}" class="btn btn-outline-primary btn-sm">
                                {% trans "Lire l'article" %}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-5" data-aos="fade-up">
            <a href="{% url 'news' %}" class="btn btn-primary btn-lg">
                <i class="fas fa-newspaper me-2"></i>
                {% trans "Toutes les Actualités" %}
            </a>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .py-6 {
        padding: 6rem 0;
    }
    
    .news-hero {
        background-attachment: fixed;
    }
    
    @media (max-width: 768px) {
        .news-hero {
            background-attachment: scroll;
        }
    }
    
    .article-meta .meta-item {
        font-size: 1rem;
        font-weight: 500;
    }
    
    .article-content,
    .article-info-card,
    .related-articles-card,
    .newsletter-card,
    .share-section,
    .author-info {
        transition: all 0.3s ease;
        border: 1px solid rgba(0,0,0,0.05);
    }
    
    .article-content:hover,
    .article-info-card:hover,
    .related-articles-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1) !important;
    }
    
    .content-rich {
        line-height: 1.8;
        font-size: 1.1rem;
    }
    
    .content-rich h1,
    .content-rich h2,
    .content-rich h3,
    .content-rich h4,
    .content-rich h5,
    .content-rich h6 {
        color: var(--bs-primary);
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: 700;
    }
    
    .content-rich h1 {
        font-size: 2rem;
    }
    
    .content-rich h2 {
        font-size: 1.75rem;
    }
    
    .content-rich h3 {
        font-size: 1.5rem;
    }
    
    .content-rich p {
        margin-bottom: 1.5rem;
        text-align: justify;
    }
    
    .content-rich ul,
    .content-rich ol {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
    }
    
    .content-rich li {
        margin-bottom: 0.5rem;
    }
    
    .content-rich blockquote {
        border-left: 4px solid var(--bs-primary);
        padding-left: 1.5rem;
        margin: 2rem 0;
        font-style: italic;
        color: #666;
        background: #f8f9fa;
        padding: 1rem 1.5rem;
        border-radius: 0 8px 8px 0;
    }
    
    .content-rich img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 1rem 0;
    }
    
    .info-item {
        padding: 1rem 0;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .info-item:last-child {
        border-bottom: none;
    }
    
    .share-buttons .btn {
        transition: all 0.3s ease;
    }
    
    .share-buttons .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .news-card-small {
        transition: all 0.3s ease;
        border: none;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .news-card-small:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    }
    
    .related-article a {
        color: #333;
        transition: color 0.3s ease;
    }
    
    .related-article a:hover {
        color: var(--bs-primary);
    }
    
    .article-tags .badge {
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .author-avatar img,
    .author-avatar div {
        border: 3px solid #e9ecef;
    }
    
    .newsletter-card {
        background: linear-gradient(135deg, var(--bs-primary) 0%, #0d6efd 100%);
    }
    
    @media (max-width: 768px) {
        .py-6 {
            padding: 4rem 0;
        }
        
        .display-4 {
            font-size: 2.5rem;
        }
        
        .article-content {
            margin-top: 2rem;
            padding: 2rem !important;
        }
        
        .article-actions .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .share-buttons {
            flex-direction: column;
        }
        
        .share-buttons .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
function shareArticle() {
    if (navigator.share) {
        navigator.share({
            title: "{{ article.title_fr|escapejs }}",
            text: "{% if LANGUAGE_CODE == 'fr' %}{{ article.content_fr|striptags|truncatewords:20|escapejs }}{% else %}{{ article.content_en|default:article.content_fr|striptags|truncatewords:20|escapejs }}{% endif %}",
            url: window.location.href
        });
    } else {
        // Fallback to WhatsApp
        shareOnWhatsApp();
    }
}

function shareOnWhatsApp() {
    const title = "{{ article.title_fr|escapejs }}";
    const url = window.location.href;
    const text = `📰 ${title}\n\nLire l'article complet : ${url}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
}

function shareOnFacebook() {
    const url = window.location.href;
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
}

function shareOnTwitter() {
    const title = "{{ article.title_fr|escapejs }}";
    const url = window.location.href;
    const text = `📰 ${title} ${url}`;
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
}

function copyLink() {
    navigator.clipboard.writeText(window.location.href).then(function() {
        // Créer une notification temporaire
        const notification = document.createElement('div');
        notification.className = 'alert alert-success position-fixed';
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = '<i class="fas fa-check me-2"></i>{% trans "Lien copié dans le presse-papier!" %}';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }).catch(function() {
        alert('{% trans "Impossible de copier le lien. Veuillez le copier manuellement." %}');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    // Améliorer la lisibilité du contenu
    const content = document.querySelector('.content-rich');
    if (content) {
        // Ajouter des classes aux éléments pour un meilleur style
        const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
        headings.forEach(heading => {
            heading.style.marginTop = '2.5rem';
            heading.style.marginBottom = '1rem';
        });
        
        const paragraphs = content.querySelectorAll('p');
        paragraphs.forEach(p => {
            p.style.textAlign = 'justify';
            p.style.lineHeight = '1.8';
        });
    }
    
    // Animation d'apparition pour les éléments
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });
    
    // Observer les cartes
    document.querySelectorAll('.article-info-card, .related-articles-card, .newsletter-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });
    
    // Temps de lecture estimé
    const content = document.querySelector('.content-rich');
    if (content) {
        const text = content.textContent || content.innerText;
        const wordsPerMinute = 200;
        const wordCount = text.split(/\s+/).length;
        const readingTime = Math.ceil(wordCount / wordsPerMinute);
        
        // Ajouter le temps de lecture à la meta
        const meta = document.querySelector('.article-meta .d-flex');
        if (meta) {
            const readingTimeElement = document.createElement('div');
            readingTimeElement.className = 'meta-item';
            readingTimeElement.innerHTML = `<i class="fas fa-book-reader me-2"></i><span>${readingTime} min de lecture</span>`;
            meta.appendChild(readingTimeElement);
        }
    }
});
</script>
{% endblock %}